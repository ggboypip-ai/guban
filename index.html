<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>æ­¤åˆ»çš„æ˜¥èŠ‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: linear-gradient(180deg, #1a0a0a 0%, #4a0e0e 30%, #8B0000 60%, #4a0404 100%);
      overflow-x: hidden;
      font-family: -apple-system, BlinkMacSystemFont, "PingFang SC",
        "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      color: #fff;
      position: relative;
    }

    /* èƒŒæ™¯è£…é¥° - æ˜Ÿæ˜Ÿ */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 0;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(255, 215, 0, 0.8);
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.5); }
    }

    /* çƒŸèŠ±å®¹å™¨ */
    .fireworks-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .firework {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
    }

    .firework::before,
    .firework::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      transform: translate(-50%, -50%);
    }

    /* çº¢åŒ…é›¨ */
    .red-packets {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 2;
    }

    .packet {
      position: absolute;
      width: 40px;
      height: 60px;
      background: linear-gradient(135deg, #d10000 0%, #8B0000 100%);
      border-radius: 4px;
      border: 2px solid #ffd700;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      animation: fall linear;
      opacity: 0.9;
    }

    .packet::before {
      content: 'ç¦';
      color: #ffd700;
      font-weight: bold;
    }

    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
      }
    }

    /* ä¸»å®¹å™¨ */
    .container {
      position: relative;
      z-index: 10;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      padding: 40px 24px;
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* é¡¶éƒ¨è£…é¥°æ  */
    .top-bar {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .music-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 215, 0, 0.3);
      color: #ffd700;
      font-size: 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .music-btn:hover {
      background: rgba(255, 215, 0, 0.2);
      transform: scale(1.1);
    }

    .music-btn.playing {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
    }

    .share-btn {
      padding: 10px 20px;
      border-radius: 20px;
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid rgba(255, 215, 0, 0.4);
      color: #ffd700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .share-btn:hover {
      background: rgba(255, 215, 0, 0.25);
      transform: translateY(-2px);
    }

    /* æ ‡é¢˜åŒºåŸŸ */
    .header {
      margin-bottom: 30px;
    }

    .year-tag {
      display: inline-block;
      padding: 8px 16px;
      background: rgba(255, 215, 0, 0.15);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 20px;
      font-size: 14px;
      color: #ffd700;
      margin-bottom: 16px;
      letter-spacing: 2px;
    }

    .main-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 8px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .sub-title {
      font-size: 16px;
      opacity: 0.8;
      font-weight: 300;
    }

    /* ç¯ç¬¼åŒºåŸŸ */
    .lantern-wrapper {
      position: relative;
      margin: 40px 0;
    }

    .lantern-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200px;
      height: 200px;
      background: radial-gradient(circle, rgba(255, 100, 100, 0.4) 0%, transparent 70%);
      border-radius: 50%;
      animation: breathe 3s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    }

    .lantern {
      position: relative;
      width: 160px;
      height: 160px;
      margin: 0 auto;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ff6b6b 0%, #d10000 50%, #8B0000 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 48px;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      box-shadow: 
        0 10px 40px rgba(209, 0, 0, 0.5),
        inset 0 -10px 20px rgba(0, 0, 0, 0.2),
        inset 0 10px 20px rgba(255, 255, 255, 0.2);
      border: 3px solid rgba(255, 215, 0, 0.5);
      z-index: 10;
    }

    .lantern::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 20px;
      background: #8B4513;
      border-radius: 4px 4px 0 0;
    }

    .lantern::after {
      content: '';
      position: absolute;
      top: -40px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 40px;
      background: linear-gradient(to bottom, transparent, rgba(255, 215, 0, 0.6));
    }

    .lantern:hover {
      transform: scale(1.05);
      box-shadow: 
        0 15px 50px rgba(209, 0, 0, 0.6),
        inset 0 -10px 20px rgba(0, 0, 0, 0.2),
        inset 0 10px 20px rgba(255, 255, 255, 0.3);
    }

    .lantern:active {
      transform: scale(0.95);
    }

    .lantern.shake {
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-5deg); }
      75% { transform: rotate(5deg); }
    }

    .lantern-hint {
      margin-top: 16px;
      font-size: 14px;
      color: rgba(255, 215, 0, 0.8);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .lantern-wrapper:hover .lantern-hint {
      opacity: 1;
    }

    /* ç¥ç¦è¯­åŒºåŸŸ */
    .blessing-container {
      min-height: 120px;
      margin: 30px 0;
      padding: 24px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      border: 1px solid rgba(255, 215, 0, 0.2);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .blessing-container::before {
      content: '"';
      position: absolute;
      top: 10px;
      left: 16px;
      font-size: 60px;
      color: rgba(255, 215, 0, 0.2);
      font-family: serif;
      line-height: 1;
    }

    .blessing {
      font-size: 22px;
      line-height: 1.8;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 300;
      position: relative;
      z-index: 1;
    }

    .blessing.show {
      opacity: 1;
      transform: translateY(0);
    }

    .blessing-author {
      margin-top: 16px;
      font-size: 14px;
      color: rgba(255, 215, 0, 0.7);
      opacity: 0;
      transition: opacity 0.8s ease 0.3s;
    }

    .blessing.show + .blessing-author,
    .blessing.show ~ .blessing-author {
      opacity: 1;
    }

    /* ç»Ÿè®¡ä¿¡æ¯ */
    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 20px 0;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .stats.show {
      opacity: 1;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 700;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
    }

    /* åº•éƒ¨åŒºåŸŸ */
    .footer-section {
      margin-top: auto;
      padding-top: 40px;
    }

    .wish-input-area {
      margin-bottom: 24px;
    }

    .wish-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 25px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      font-size: 14px;
      outline: none;
      transition: all 0.3s ease;
      text-align: center;
    }

    .wish-input::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .wish-input:focus {
      border-color: rgba(255, 215, 0, 0.6);
      background: rgba(255, 255, 255, 0.15);
    }

    .wish-btn {
      margin-top: 12px;
      padding: 12px 32px;
      border-radius: 25px;
      border: none;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #8B0000;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .wish-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 215, 0, 0.4);
    }

    .footer {
      font-size: 12px;
      opacity: 0.4;
      margin-top: 24px;
    }

    .footer-divider {
      width: 60px;
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(255, 215, 0, 0.5), transparent);
      margin: 0 auto 16px;
    }

    /* æç¤ºæ¶ˆæ¯ */
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.9);
      padding: 16px 32px;
      background: rgba(0, 0, 0, 0.8);
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 12px;
      color: #ffd700;
      font-size: 16px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .toast.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
    }

    /* å“åº”å¼ */
    @media (max-width: 480px) {
      .container {
        padding: 30px 20px;
      }
      
      .main-title {
        font-size: 24px;
      }
      
      .lantern {
        width: 140px;
        height: 140px;
        font-size: 40px;
      }
      
      .blessing {
        font-size: 18px;
      }
    }
  </style>
</head>

<body>
  <!-- èƒŒæ™¯æ˜Ÿæ˜Ÿ -->
  <div class="stars" id="stars"></div>
  
  <!-- çƒŸèŠ±å®¹å™¨ -->
  <div class="fireworks-container" id="fireworks"></div>
  
  <!-- çº¢åŒ…é›¨å®¹å™¨ -->
  <div class="red-packets" id="redPackets"></div>

  <div class="container">
    <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
    <div class="top-bar">
      <button class="music-btn" id="musicBtn" title="èƒŒæ™¯éŸ³ä¹">ğŸµ</button>
      <button class="share-btn" id="shareBtn">åˆ†äº«ç¥ç¦</button>
    </div>

    <!-- æ ‡é¢˜ -->
    <div class="header">
      <div class="year-tag">ğŸ§§ ä¹™å·³è›‡å¹´</div>
      <h1 class="main-title">æ­¤åˆ»çš„æ˜¥èŠ‚</h1>
      <p class="sub-title">ç‚¹ä¸€ç›ç¯ï¼Œè®¸ä¸€ä¸ªæ„¿</p>
    </div>

    <!-- ç¯ç¬¼ -->
    <div class="lantern-wrapper">
      <div class="lantern-glow"></div>
      <div class="lantern" id="lantern">ğŸ®</div>
      <div class="lantern-hint">ç‚¹å‡»ç¯ç¬¼ï¼Œé¢†å–æ–°å¹´ç¥ç¦</div>
    </div>

    <!-- ç¥ç¦è¯­ -->
    <div class="blessing-container">
      <div class="blessing" id="blessing">
        ç­‰å¾…ä½ çš„ç¬¬ä¸€ç›ç¯...
      </div>
      <div class="blessing-author" id="blessingAuthor">â€”â€” æ­¤åˆ»çš„æ˜¥èŠ‚</div>
    </div>

    <!-- ç»Ÿè®¡ -->
    <div class="stats" id="stats">
      <div class="stat-item">
        <div class="stat-number" id="clickCount">0</div>
        <div class="stat-label">ç‚¹äº®æ¬¡æ•°</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="uniqueCount">0</div>
        <div class="stat-label">æ”¶é›†ç¥ç¦</div>
      </div>
    </div>

    <!-- åº•éƒ¨ -->
    <div class="footer-section">
      <div class="wish-input-area">
        <input type="text" class="wish-input" id="wishInput" placeholder="å†™ä¸‹ä½ çš„æ–°å¹´æ„¿æœ›..." maxlength="30">
        <button class="wish-btn" id="wishBtn">æ”¾é£æ„¿æœ›</button>
      </div>
      
      <div class="footer-divider"></div>
      <div class="footer">æ„¿è¿™ä¸€åˆ»ï¼Œè¢«å¥½å¥½è®°ä½</div>
    </div>
  </div>

  <!-- æç¤ºæ¶ˆæ¯ -->
  <div class="toast" id="toast"></div>

  <script>
    // ç¥ç¦è¯­åº“
    const blessings = [
      { text: "ä»Šå¹´ï¼Œæ…¢ä¸€ç‚¹ä¹Ÿæ²¡å…³ç³»ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ä½ å·²ç»èµ°äº†å¾ˆè¿œäº†ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ç°åœ¨è¿™æ ·ï¼Œå°±æŒºå¥½çš„ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "è¿™ä¸€å¹´ï¼Œè¾›è‹¦äº†ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "å›ä¸å›å®¶ï¼Œéƒ½ç®—è¿‡å¹´ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ç¯è¿˜äº®ç€ï¼Œä½ ä¸å­¤å•ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ä¸éœ€è¦æƒ³å¤ªå¤šï¼Œå…ˆè¿‡å®Œä»Šå¤©ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "æ­‡ä¸€ä¼šå„¿ï¼Œä¸ç®—é€ƒé¿ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ä¸–ç•Œåœ¨æ…¢æ…¢å®‰é™ä¸‹æ¥ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "è¿™ä¸€åˆ»ï¼Œå…ˆç•™ç»™è‡ªå·±ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "æ„¿ä½ çœ¼é‡Œæœ‰å…‰ï¼Œå¿ƒä¸­æœ‰çˆ±ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "æ‰€æœ‰çš„ç¾å¥½ï¼Œéƒ½åœ¨è·¯ä¸Šã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "æ–°çš„ä¸€å¹´ï¼Œåšè‡ªå·±çš„å¤ªé˜³ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "ç”Ÿæ´»æ˜æœ—ï¼Œä¸‡ç‰©å¯çˆ±ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" },
      { text: "æ„¿ä½ è¢«è¿™ä¸ªä¸–ç•Œæ¸©æŸ”ä»¥å¾…ã€‚", author: "æ­¤åˆ»çš„æ˜¥èŠ‚" }
    ];

    // ç”¨æˆ·è‡ªå®šä¹‰æ„¿æœ›
    let customWishes = JSON.parse(localStorage.getItem('customWishes') || '[]');

    // çŠ¶æ€
    let clickCount = parseInt(localStorage.getItem('clickCount') || '0');
    let seenBlessings = new Set(JSON.parse(localStorage.getItem('seenBlessings') || '[]'));
    let isPlaying = false;
    let audioContext = null;

    // DOM å…ƒç´ 
    const lantern = document.getElementById('lantern');
    const blessing = document.getElementById('blessing');
    const blessingAuthor = document.getElementById('blessingAuthor');
    const clickCountEl = document.getElementById('clickCount');
    const uniqueCountEl = document.getElementById('uniqueCount');
    const stats = document.getElementById('stats');
    const musicBtn = document.getElementById('musicBtn');
    const shareBtn = document.getElementById('shareBtn');
    const wishInput = document.getElementById('wishInput');
    const wishBtn = document.getElementById('wishBtn');
    const toast = document.getElementById('toast');
    const fireworksContainer = document.getElementById('fireworks');
    const redPacketsContainer = document.getElementById('redPackets');

    // åˆå§‹åŒ–
    function init() {
      updateStats();
      createStars();
      startRedPacketRain();
      
      // æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„éŸ³ä¹çŠ¶æ€
      if (localStorage.getItem('musicPlaying') === 'true') {
        toggleMusic();
      }
    }

    // åˆ›å»ºèƒŒæ™¯æ˜Ÿæ˜Ÿ
    function createStars() {
      const starsContainer = document.getElementById('stars');
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        starsContainer.appendChild(star);
      }
    }

    // çƒŸèŠ±æ•ˆæœ
    function createFirework(x, y) {
      const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#ffe66d', '#ff8c42', '#ff6b9d', '#c7f464'];
      const color = colors[Math.floor(Math.random() * colors.length)];
      
      for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.className = 'firework';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.background = color;
        
        const angle = (i / 12) * Math.PI * 2;
        const velocity = 100 + Math.random() * 50;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;
        
        particle.style.setProperty('--vx', vx + 'px');
        particle.style.setProperty('--vy', vy + 'px');
        
        fireworksContainer.appendChild(particle);
        
        // åŠ¨ç”»
        const duration = 800 + Math.random() * 400;
        particle.animate([
          { transform: 'translate(0, 0) scale(1)', opacity: 1 },
          { transform: `translate(${vx}px, ${vy}px) scale(0)`, opacity: 0 }
        ], {
          duration: duration,
          easing: 'cubic-bezier(0, .9, .57, 1)'
        }).onfinish = () => particle.remove();
      }
    }

    // çº¢åŒ…é›¨
    function startRedPacketRain() {
      setInterval(() => {
        if (Math.random() > 0.7) return; // æ§åˆ¶å¯†åº¦
        
        const packet = document.createElement('div');
        packet.className = 'packet';
        packet.style.left = Math.random() * 100 + '%';
        packet.style.animationDuration = (5 + Math.random() * 5) + 's';
        packet.style.opacity = 0.3 + Math.random() * 0.4;
        
        redPacketsContainer.appendChild(packet);
        
        setTimeout(() => packet.remove(), 10000);
      }, 2000);
    }

    // ç‚¹å‡»ç¯ç¬¼
    lantern.addEventListener('click', (e) => {
      // æ›´æ–°è®¡æ•°
      clickCount++;
      localStorage.setItem('clickCount', clickCount);
      
      // è·å–éšæœºç¥ç¦
      const allBlessings = [...blessings, ...customWishes.map(w => ({ text: w, author: 'ä½ çš„å¿ƒæ„¿' }))];
      const randomIndex = Math.floor(Math.random() * allBlessings.length);
      const selected = allBlessings[randomIndex];
      
      // è®°å½•å·²è§
      seenBlessings.add(randomIndex);
      localStorage.setItem('seenBlessings', JSON.stringify([...seenBlessings]));
      
      // åŠ¨ç”»æ•ˆæœ
      lantern.classList.add('shake');
      setTimeout(() => lantern.classList.remove('shake'), 500);
      
      // çƒŸèŠ±
      const rect = lantern.getBoundingClientRect();
      createFirework(rect.left + rect.width / 2, rect.top + rect.height / 2);
      
      // æ’­æ”¾éŸ³æ•ˆ
      playBellSound();
      
      // æ˜¾ç¤ºç¥ç¦
      blessing.classList.remove('show');
      setTimeout(() => {
        blessing.textContent = selected.text;
        blessingAuthor.textContent = 'â€”â€” ' + selected.author;
        blessing.classList.add('show');
        stats.classList.add('show');
        updateStats();
      }, 100);
    });

    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      clickCountEl.textContent = clickCount;
      uniqueCountEl.textContent = seenBlessings.size;
    }

    // æ’­æ”¾é“ƒå£°ï¼ˆWeb Audio APIï¼‰
    function playBellSound() {
      if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      }
      
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();
      
      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);
      
      oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
      oscillator.frequency.exponentialRampToValueAtTime(1046.5, audioContext.currentTime + 0.1);
      
      gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
      
      oscillator.start(audioContext.currentTime);
      oscillator.stop(audioContext.currentTime + 0.5);
    }

    // èƒŒæ™¯éŸ³ä¹ï¼ˆæ¨¡æ‹Ÿï¼‰
    function toggleMusic() {
      isPlaying = !isPlaying;
      musicBtn.classList.toggle('playing', isPlaying);
      musicBtn.textContent = isPlaying ? 'ğŸ””' : 'ğŸµ';
      localStorage.setItem('musicPlaying', isPlaying);
      showToast(isPlaying ? 'èƒŒæ™¯éŸ³ä¹å·²å¼€å¯' : 'èƒŒæ™¯éŸ³ä¹å·²å…³é—­');
    }

    musicBtn.addEventListener('click', toggleMusic);

    // åˆ†äº«åŠŸèƒ½
    shareBtn.addEventListener('click', () => {
      const text = `æˆ‘åœ¨"æ­¤åˆ»çš„æ˜¥èŠ‚"ç‚¹äº®äº†${clickCount}ç›ç¯ï¼Œæ”¶é›†äº†${seenBlessings.size}ä¸ªç¥ç¦ã€‚æ„¿è¿™ä¸€å¹´ï¼Œæ…¢ä¸€ç‚¹ä¹Ÿæ²¡å…³ç³»ã€‚`;
      
      if (navigator.share) {
        navigator.share({
          title: 'æ­¤åˆ»çš„æ˜¥èŠ‚',
          text: text,
          url: window.location.href
        });
      } else {
        navigator.clipboard.writeText(text).then(() => {
          showToast('ç¥ç¦å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        });
      }
    });

    // æ”¾é£æ„¿æœ›
    wishBtn.addEventListener('click', () => {
      const wish = wishInput.value.trim();
      if (!wish) {
        showToast('è¯·å…ˆå†™ä¸‹ä½ çš„æ„¿æœ›');
        return;
      }
      
      customWishes.push(wish);
      localStorage.setItem('customWishes', JSON.stringify(customWishes));
      
      wishInput.value = '';
      showToast('æ„¿æœ›å·²æ”¾é£ï¼Œä¼šéšæœºå‡ºç°åœ¨ç¥ç¦ä¸­');
      
      // åˆ›å»ºç‰¹æ®ŠçƒŸèŠ±
      const rect = wishBtn.getBoundingClientRect();
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          createFirework(rect.left + rect.width / 2, rect.top);
        }, i * 200);
      }
    });

    // æ˜¾ç¤ºæç¤º
    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // å¯åŠ¨
    init();
  </script>
</body>
</html>
